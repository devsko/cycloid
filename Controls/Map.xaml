<UserControl
    x:Class="cycloid.Controls.Map"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:cycloid="using:cycloid"
    xmlns:maps="using:Windows.UI.Xaml.Controls.Maps">

    <maps:MapControl
        x:Name="MapControl"
        MapServiceToken="h2SdNrCncYPsgAfOlITE~4Yo41G6AvCkvigXhUwChig~AmjpNLnULNqoAMPx1H7BpgopNheySzWQC0aXrpBONC87WXgIfNSPaHBu32g1aQ8A"
        Style="{x:Bind Mode=OneWay, Path=ViewModel.MapStyleAndColor.Style}"
        ColorScheme="{x:Bind Mode=OneWay, Path=ViewModel.MapStyleAndColor.Color}"
        Loaded="MapControl_Loaded"
        MapTapped="MapControl_MapTapped"
        MapRightTapped="MapControl_MapRightTapped">

        <maps:MapControl.Resources>
            <maps:MapTileSource
                x:Name="Heatmap"
                IsFadingEnabled="False"
                Visible="{x:Bind Mode=OneWay, Path=ViewModel.HeatmapVisible}">
                <maps:MapTileSource.DataSource>
                    <maps:HttpMapTileDataSource 
                        UriFormatString="{x:Bind Mode=OneTime, Path=ViewModel.HeatmapUri}" />
                </maps:MapTileSource.DataSource>
            </maps:MapTileSource>
            <maps:MapTileSource
                x:Name="Osm"
                IsFadingEnabled="false"
                Visible="{x:Bind Mode=OneWay, Path=ViewModel.MapStyleAndColor.Osm}"
                Layer="BackgroundReplacement">
                <maps:MapTileSource.DataSource>
                    <maps:HttpMapTileDataSource
                        UriFormatString="{x:Bind Mode=OneTime, Path=ViewModel.OsmUri}" />
                </maps:MapTileSource.DataSource>
            </maps:MapTileSource>
            <maps:MapElementsLayer
                x:Name="TrackLayer"
                MapElementClick="TrackLayer_MapElementClick"
                MapElementPointerEntered="TrackLayer_MapElementPointerEntered"
                MapElementPointerExited="TrackLayer_MapElementPointerExited" />
            <maps:MapElementsLayer
                x:Name="RoutePointsLayer"
                MapElementClick="RoutePointsLayer_MapElementClick"
                MapElementPointerEntered="RoutePointsLayer_MapElementPointerEntered"
                MapElementPointerExited="RoutePointsLayer_MapElementPointerExited" />
        </maps:MapControl.Resources>

        <Border 
            maps:MapControl.NormalizedAnchorPoint=".5 .5"
            maps:MapControl.Location="{x:Bind Mode=OneWay, Path=cycloid:Convert.ToGeopoint(CurrentPoint)}"
            Visibility="{x:Bind Mode=OneWay, Path=cycloid:Convert.VisibleIfNotNull(CurrentPoint)}">
            <Grid>
                <Ellipse 
                    Width="15" 
                    Height="15" 
                    Fill="Black" />
                <Ellipse 
                    Width="12" 
                    Height="12" 
                    Fill="White" />
                <Ellipse 
                    Width="8" 
                    Height="8"
                    Fill="{x:Bind Mode=OneWay, Path=cycloid:Convert.GradientToBrush(CurrentPoint.Value.Gradient)}"/>
            </Grid>
        </Border>
        
    </maps:MapControl>

</UserControl>
