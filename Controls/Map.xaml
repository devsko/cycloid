<UserControl
    x:Class="cycloid.Controls.Map"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:controls="using:cycloid.Controls"
    xmlns:cycloid="using:cycloid"
    xmlns:maps="using:Windows.UI.Xaml.Controls.Maps">

    <maps:MapControl
        x:Name="MapControl"
        ColorScheme="{x:Bind Mode=OneWay, Path=ViewModel.MapStyleAndColor.Color}"
        Loaded="MapControl_Loaded"
        MapRightTapped="MapControl_MapRightTapped"
        MapServiceToken="{cycloid:ConfigurationValue Key=Bing:ServiceApiKey}"
        MapTapped="MapControl_MapTapped"
        Style="{x:Bind Mode=OneWay, Path=ViewModel.MapStyleAndColor.Style}">

        <maps:MapControl.Resources>
            <maps:MapTileSource
                x:Name="Heatmap"
                IsFadingEnabled="False"
                Visible="{x:Bind Mode=OneWay, Path=ViewModel.HeatmapVisible}">
                <maps:MapTileSource.DataSource>
                    <maps:HttpMapTileDataSource UriFormatString="{x:Bind Mode=OneTime, Path=ViewModel.HeatmapUri}" />
                </maps:MapTileSource.DataSource>
            </maps:MapTileSource>
            <maps:MapTileSource
                x:Name="Osm"
                IsFadingEnabled="false"
                Layer="BackgroundReplacement"
                Visible="{x:Bind Mode=OneWay, Path=ViewModel.MapStyleAndColor.Osm}">
                <maps:MapTileSource.DataSource>
                    <maps:HttpMapTileDataSource UriFormatString="{x:Bind Mode=OneTime, Path=ViewModel.OsmUri}" />
                </maps:MapTileSource.DataSource>
            </maps:MapTileSource>
            <maps:MapElementsLayer
                x:Name="TrackLayer"
                MapElementClick="TrackLayer_MapElementClick"
                MapElementPointerEntered="TrackLayer_MapElementPointerEntered"
                MapElementPointerExited="TrackLayer_MapElementPointerExited" />
            <maps:MapElementsLayer
                x:Name="RoutePointsLayer"
                MapElementClick="RoutePointsLayer_MapElementClick"
                MapElementPointerEntered="RoutePointsLayer_MapElementPointerEntered"
                MapElementPointerExited="RoutePointsLayer_MapElementPointerExited" />
        </maps:MapControl.Resources>

        <!--  CurrentPoint  -->
        <Border
            maps:MapControl.Location="{x:Bind Mode=OneWay, Path=cycloid:Convert.ToGeopoint(ViewModel.CurrentPoint)}"
            maps:MapControl.NormalizedAnchorPoint=".5 .5"
            Visibility="{x:Bind Mode=OneWay, Path=cycloid:Convert.VisibleIfNotNull(ViewModel.CurrentPoint)}">
            <Grid>
                <Ellipse
                    Width="15"
                    Height="15"
                    Fill="Black" />
                <Ellipse
                    Width="12"
                    Height="12"
                    Fill="White" />
                <Ellipse
                    Width="8"
                    Height="8"
                    Fill="{x:Bind Mode=OneWay, Path=cycloid:Convert.GradientToBrush(ViewModel.CurrentPoint.Value.Gradient)}" />
            </Grid>
        </Border>

        <!--  HoverPoint  -->
        <Border
            maps:MapControl.Location="{x:Bind Mode=OneWay, Path=cycloid:Convert.ToGeopoint(ViewModel.HoverPoint)}"
            maps:MapControl.NormalizedAnchorPoint=".5 .5"
            Visibility="{x:Bind Mode=OneWay, Path=cycloid:Convert.VisibleIfNotNull(ViewModel.HoverPoint)}">
            <Grid>
                <Ellipse
                    Width="10"
                    Height="10"
                    Fill="Black" />
                <Ellipse
                    Width="7"
                    Height="7"
                    Fill="White" />
            </Grid>
        </Border>

        <!--  HoverPointValues  -->
        <controls:MapHoverPointValues
            Enabled="{x:Bind Mode=OneWay, Path=ViewModel.MapHoverPointValuesEnabled}"
            Point="{x:Bind Mode=OneWay, Path=ViewModel.HoverPoint}"
            Track="{x:Bind Mode=OneWay, Path=ViewModel.Track}" />

    </maps:MapControl>

</UserControl>
